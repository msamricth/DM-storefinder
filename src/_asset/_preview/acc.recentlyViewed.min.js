ACC.recentlyViewed={_autoload:["createCookieFlag",["initRecentlyViewed",0!=$(".js-recently-viewed-parent").length],["bindRemoveItem",0!=$(".js-recently-viewed-parent").length],["showAlternateImage",0!=$(".js-recently-viewed-parent").length],["hideCookieWarning",0!=$(".js-recently-viewed-parent").length]],localStorageKey:"recentlyViewed_"+ACC.config.site,showRecentlyViewedPopupFlagType1:"showRecentlyViewedPopupFlagType1_"+ACC.config.site,showRecentlyViewedPopupFlagType2:"showRecentlyViewedPopupFlagType2_"+ACC.config.site,showRecentlyViewedPopupFlagType1Shown:"showRecentlyViewedPopupFlagType1Shown_"+ACC.config.site,showRecentlyViewedPopupFlagType2Shown:"showRecentlyViewedPopupFlagType2Shown_"+ACC.config.site,storageMaxCount:20,itemsDetailsList:[],getRecentlyViewedItems:function(){var recentlyViewedItems=[],localStorageRecentlyViewed=localStorage.getItem(ACC.recentlyViewed.localStorageKey);return recentlyViewedItems=localStorageRecentlyViewed?JSON.parse(localStorageRecentlyViewed):recentlyViewedItems},pushItemToLocalStorage:function(){var recentlyViewedItems=ACC.recentlyViewed.getRecentlyViewedItems(),colourVariantCode=$(".js-product-variant-code").val(),objItem={colourVariantCode:colourVariantCode,addedDate:(new Date).toISOString()},index=recentlyViewedItems.findIndex(item=>item.colourVariantCode==colourVariantCode);0<=index&&recentlyViewedItems.splice(index,1),recentlyViewedItems.push(objItem),recentlyViewedItems.length>ACC.recentlyViewed.storageMaxCount&&(index=recentlyViewedItems.length-ACC.recentlyViewed.storageMaxCount,recentlyViewedItems.splice(0,index)),localStorage.setItem(ACC.recentlyViewed.localStorageKey,JSON.stringify(recentlyViewedItems)),1===ACC.recentlyViewed.getRecentlyViewedItems().length&&(localStorage.setItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType1,!0),sessionStorage.setItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType2,!1))},initNavIcon:function(){var $navIcon=$(".dm-navigation-recently-viewed"),itemCount=ACC.recentlyViewed.getRecentlyViewedItems().length;$navIcon.removeClass("hidden"),0<itemCount&&($navIcon.addClass("active"),$(".dm-navigation-recently-viewed .recently-viewed-count").html(itemCount))},showHideRecentlyViewedPopup:function(actionType){var $recentlyViewedPopup=$(".dm-navigation-search .recently-viewed-wrapper .recently-viewed-popup");"HIDE"===actionType?($(".dm-navigation-search .recently-viewed-wrapper .recently-viewed-popup .innerContent").empty(),$recentlyViewedPopup.hasClass("hide")||$recentlyViewedPopup.addClass("hide")):"SHOW"===actionType&&$recentlyViewedPopup.hasClass("hide")&&$recentlyViewedPopup.removeClass("hide")},bindIconClick:function(){$(document).on("click",".js-recently-viewed",function(e){e.preventDefault();var colourVariantCode,e=ACC.recentlyViewed.getRecentlyViewedItems(),count=e.length,device=ACC.os.isViewportBreakpoint("mobile")?"m":"d";$("body").hasClass("page-productDetails")&&$(".never-be-back__title").length<1&&(colourVariantCode=$(".js-product-variant-code").val(),-1===e.findIndex(item=>item.colourVariantCode==colourVariantCode)&&count<20&&count++),window.location=ACC.config.sitePath+"/recent?c="+count+"&d="+device});$(document).on("click",".dm-navigation-search .recently-viewed-wrapper .recently-viewed-popup .close-icon",function(e){e.preventDefault(),e.stopPropagation(),ACC.recentlyViewed.showHideRecentlyViewedPopup("HIDE")})},initRecentlyViewed:function(){var recentlyViewedEntries=ACC.recentlyViewed.getRecentlyViewedItems(),recentlyViewedEntries=(ACC.recentlyViewed.updateProductCount(recentlyViewedEntries.length),recentlyViewedEntries.map(function(entry){return entry.colourVariantCode}));recentlyViewedEntries.reverse(),$.ajax({type:"POST",url:"/dmrest/v2/"+ACC.config.site+"/users/anonymous/wishlists/anonymous-wishlist/?lang="+ACC.config.language+"&fields=FULL",data:JSON.stringify(recentlyViewedEntries),contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){ACC.recentlyViewed.itemsDetailsList=data.entries,ACC.recentlyViewed.initProductList()},error:function(data){}})},initProductList(){function renderList(entries){var sourceList,isMobileNav=ACC.os.isViewportBreakpoint("mobile");0<(entries=ACC.recentlyViewed.itemsDetailsList.map(function(entry,index){return entry.colourVariantProductCode||(entry.colourVariantProductCode=productCodes[index]),entry.isMobileNav=isMobileNav,entry.wasPrice&&(index={currentPrice:entry.price.value,originalPrice:entry.wasPrice.value,lastLowestPrice:entry.lastLowestPrice?entry.lastLowestPrice.value:"",currentFormatted:entry.price.formattedValue},ACC.global.getSavings(entry,index,!0),entry.hasSavingsClass="special-price"),entry})).length&&(sourceList=$("#recently-viewed-template").html(),ACC.helper.init(),sourceList=Handlebars.compile(sourceList),$("#recently-viewed-products").html(sourceList(entries)),ACC.track.publishProductImpressionsEvent())}enquire.register("screen and (max-width:"+screenXsMax+")",{match:function(){renderList()}}),enquire.register("screen and (min-width:"+screenSm+")",{match:function(){renderList()}})},bindRemoveItem:function(){$(document).on("click",".js-remove-item",function(){var $this=$(this),$navIcon=$(".dm-navigation-recently-viewed"),colourVariantCode=$this.data("code"),$this=ACC.recentlyViewed.getRecentlyViewedItems(),index=$this.findIndex(item=>item.colourVariantCode==colourVariantCode);$this.splice(index,1),localStorage.setItem(ACC.recentlyViewed.localStorageKey,JSON.stringify($this)),$(this).closest(".js-list-item").remove(),ACC.recentlyViewed.updateProductCount($this.length),$(".dm-navigation-recently-viewed .recently-viewed-count").html($this.length),0==$this.length&&$navIcon.removeClass("active")})},updateProductCount:function(count){1===count?($(".js-txt-products").addClass("hide"),$(".js-txt-product").removeClass("hide")):($(".js-txt-products").removeClass("hide"),$(".js-txt-product").addClass("hide")),$(".js-product-count").text(count),0==count?($(".js-no-products").removeClass("hide"),$(".js-recently-viewed-products").addClass("hide")):($(".js-no-products").addClass("hide"),$(".js-recently-viewed-products").removeClass("hide"))},showAlternateImage:function(){var rvImg=".products-list__image";$(document).on("mouseenter",rvImg,function(){var $this=$(this),$productImg=$this.find("img"),altImgUrl=$this.data("alternateImg"),$this=$this.data("alternateSmartImg");null!=$this?$productImg.attr("srcset",$this+"?$smart160$&fmt=auto 160w, "+$this+"?$smart320$&fmt=auto 320w,"+$this+"?$smart576$&fmt=auto 576w,"+$this+"?$smart768$&fmt=auto 768w"):""!=altImgUrl&&null!=altImgUrl&&$productImg.attr("src",altImgUrl)}).on("mouseleave",rvImg,function(){var $this=$(this),$productImg=$this.find("img"),origImgUrl=$this.data("primaryImg"),$this=$this.data("primarySmartImg");null!=$this?$productImg.attr("srcset",$this+"?$smart160$&fmt=auto 160w, "+$this+"?$smart320$&fmt=auto 320w,"+$this+"?$smart576$&fmt=auto 576w,"+$this+"?$smart768$&fmt=auto 768w"):""!=origImgUrl&&null!=origImgUrl&&$productImg.attr("src",origImgUrl)})},createCookieFlag:function(){var d;document.cookie.indexOf("recentlyViewed=")<0&&((d=new Date).setTime(d.getTime()+307584e5),d="expires="+d.toUTCString(),document.cookie="recentlyViewed=TRUE;"+d+";path=/")},hideCookieWarning:function(){$(".js-disabled-warning").addClass("hide")},initRecentlyViewedPopup:function(){var $recentlyViewedPopupInnerContentTextOne,$recentlyViewedPopupInnerContentTextTwo;0===ACC.recentlyViewed.getRecentlyViewedItems().filter(function(m_item){return-1<window.location.href.indexOf(m_item.colourVariantCode)}).length&&($recentlyViewedPopupInnerContentTextOne=$(".dm-navigation-search .recently-viewed-wrapper .recently-viewed-popup .innerContent .inner-content-text-one"),$recentlyViewedPopupInnerContentTextTwo=$(".dm-navigation-search .recently-viewed-wrapper .recently-viewed-popup .innerContent .inner-content-text-two"),1===ACC.recentlyViewed.getRecentlyViewedItems().length&&"true"===localStorage.getItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType1)&&"true"!==localStorage.getItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType1Shown)&&($recentlyViewedPopupInnerContentTextOne.html(ACC.config.labels.recentlyViewedPopupTextOne),$recentlyViewedPopupInnerContentTextTwo.css("padding-top","0"),ACC.recentlyViewed.showHideRecentlyViewedPopup("SHOW"),localStorage.setItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType1Shown,!0),setTimeout(function(){ACC.recentlyViewed.showHideRecentlyViewedPopup("HIDE")},5e3)),0<ACC.recentlyViewed.getRecentlyViewedItems().length&&"true"===sessionStorage.getItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType2)&&"true"!==sessionStorage.getItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType2Shown)&&($recentlyViewedPopupInnerContentTextOne.html(ACC.config.labels.recentlyViewedPopupTextTwoLabelOne),$recentlyViewedPopupInnerContentTextTwo.html(ACC.config.labels.recentlyViewedPopupTextTwoLabelTwo),ACC.recentlyViewed.showHideRecentlyViewedPopup("SHOW"),sessionStorage.setItem(ACC.recentlyViewed.showRecentlyViewedPopupFlagType2Shown,!0)))}},$(document).ready(function(){ACC.recentlyViewed.initRecentlyViewedPopup(),$("body").hasClass("page-productDetails")&&$(".never-be-back__title").length<1&&ACC.recentlyViewed.pushItemToLocalStorage()}),ACC.recentlyViewed.initNavIcon(),ACC.recentlyViewed.bindIconClick();